[Unit]
Description=Setup a secure tunnel to %I
After=network-online.target

[Service]
User=autossh
EnvironmentFile=/etc/default/secure-tunnel@%i

ExecStart=/usr/bin/ssh -NT \
  -o ServerAliveInterval=60 -o ExitOnForwardFailure=yes \
  "${REMOTE_SSH_USER}@${REMOTE_SSH_HOST}" -p "${REMOTE_SSH_PORT}" \
  -R "${REMOTE_TUNNEL_PORT}:127.0.0.1:${LOCAL_TUNNEL_PORT}"

# Restart every >2 seconds to avoid StartLimitInterval failure
RestartSec=5
Restart=always

[Install]
WantedBy=multi-user.target